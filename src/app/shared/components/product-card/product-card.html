// src/app/shared/components/product-card/product-card.component.html

<div class="card card-hover h-full flex flex-col relative group">
  <!-- Badges -->
  <div class="absolute top-2 left-2 z-10 flex flex-col gap-2">
    @if (product.discount && product.discount > 0) {
      <span class="discount-badge">
        -{{ product.discount }}%
      </span>
    }
    @for (badge of product.badges; track badge) {
      <span [class]="getBadgeClass(badge)">
        {{ badge === 'promo' ? 'PROMO' : badge === 'new' ? 'NOUVEAU' : badge === 'popular' ? 'POPULAIRE' : badge }}
      </span>
    }
  </div>

  <!-- Image -->
  <a [routerLink]="['/products', product.slug]" class="block relative overflow-hidden bg-premice-gray-50">
    <div class="aspect-product">
      @if (product.images.thumbnail) {
        <img
          [src]="product.images.thumbnail"
          [alt]="product.name"
          class="w-full h-full object-contain p-4 group-hover:scale-105 transition-transform duration-300"
          loading="lazy"
          (error)="$event.target.src = 'https://placehold.co/400x300/e0e0e0/666666?text=Premice+Computer'"
        />
      } @else {
        <div class="w-full h-full flex items-center justify-center bg-premice-gray-100">
          <span class="text-premice-gray-400 text-sm">Image non disponible</span>
        </div>
      }
    </div>

    <!-- Quick view hover overlay -->
    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
      <span class="bg-white text-premice-red px-4 py-2 rounded-lg font-semibold transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
        Voir le d√©tail
      </span>
    </div>
  </a>

  <!-- Content -->
  <div class="p-4 flex flex-col flex-1">
    <!-- Brand -->
    <div class="text-sm text-premice-gray-600 font-medium mb-1">
      {{ product.brand }}
    </div>

    <!-- Product name -->
    <a [routerLink]="['/products', product.slug]" class="block mb-2">
      <h3 class="text-base font-semibold text-premice-gray-900 line-clamp-2 hover:text-premice-red transition-colors min-h-[3rem]">
        {{ product.name }}
      </h3>
    </a>

    <!-- Rating -->
    @if (product.rating) {
      <div class="flex items-center gap-2 mb-3">
        <div class="flex items-center">
          @for (star of [1,2,3,4,5]; track star) {
            <span [class]="star <= product.rating.average ? 'text-premice-yellow' : 'text-premice-gray-300'">
              ‚òÖ
            </span>
          }
        </div>
        <span class="text-sm text-premice-gray-600">
          ({{ product.rating.count }})
        </span>
      </div>
    }

    <!-- Stock status -->
    <div class="mb-3">
      <span [class]="'text-sm font-semibold ' + getStockStatus().class">
        {{ getStockStatus().text }}
      </span>
    </div>

    <!-- Spacer -->
    <div class="flex-1"></div>

    <!-- Price -->
    <div class="mb-3">
      <div class="flex items-center gap-2 flex-wrap">
        <span class="price-sm">
          {{ formatPrice(product.price) }} {{ product.currency }}
        </span>
        @if (product.oldPrice && product.oldPrice > product.price) {
          <span class="old-price text-sm">
            {{ formatPrice(product.oldPrice) }} {{ product.currency }}
          </span>
        }
      </div>
    </div>

    <!-- Add to cart button -->
    <button
      (click)="addToCart($event)"
      [disabled]="!product.inStock || isAddingToCart()"
      [class]="product.inStock ? 'btn btn-primary w-full' : 'btn btn-outline w-full opacity-50 cursor-not-allowed'"
    >
      @if (isAddingToCart()) {
        <span class="animate-spin">‚è≥</span>
        Ajout...
      } @else if (!product.inStock) {
        Rupture de stock
      } @else {
        üõí Ajouter au panier
      }
    </button>
  </div>

  <!-- Toast notification -->
  @if (showAddedToast()) {
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white shadow-2xl rounded-lg p-4 z-20 animate-scale-up">
      <div class="flex items-center gap-3">
        <span class="text-3xl">‚úì</span>
        <div>
          <div class="font-semibold text-green-600">Ajout√© au panier !</div>
          <div class="text-sm text-premice-gray-600">{{ product.name }}</div>
        </div>
      </div>
    </div>
  }
</div>